# ğŸ”§ ì°¨íŠ¸ ë ˆì´ì–´ ìˆœì„œ ë° í”„ë¡¬í”„íŠ¸ ì—ëŸ¬ ì™„ì „ í•´ê²°

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1ï¸âƒ£ **êº¾ì€ì„  ê·¸ë˜í”„ë¥¼ ë§‰ëŒ€ ìœ„ì— í‘œì‹œ**

- âœ… `order` ì†ì„± ì¶”ê°€ (ë‚®ì„ìˆ˜ë¡ ìœ„ì— í‘œì‹œ)
- âœ… ë°ì´í„°ì…‹ ìˆœì„œ ë³€ê²½ (line â†’ bar)

### 2ï¸âƒ£ **í”„ë¡¬í”„íŠ¸ ìƒì„± ì—ëŸ¬ ì™„ì „ ì œê±°**

- âœ… f-string ë‚´ë¶€ `json.dumps()` ì œê±°
- âœ… ë‹¨ìˆœ í…ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ë³€ê²½
- âœ… ì•ˆì „í•œ JSON ë³€í™˜

---

## ğŸ“Š 1. ì°¨íŠ¸ ë ˆì´ì–´ ìˆœì„œ ê°œì„ 

### Before (ë§‰ëŒ€ê°€ ìœ„ì— í‘œì‹œë¨) âŒ

```javascript
datasets = [
    // ë§‰ëŒ€ ë¨¼ì € ì¶”ê°€
    { type: 'bar', label: 'ë°°ì†¡', ... },
    { type: 'bar', label: 'í™˜ë¶ˆ', ... },
    // êº¾ì€ì„  ë‚˜ì¤‘ì— ì¶”ê°€
    { type: 'line', label: 'ì „ì²´ í•©ê³„', ... }
];
```

**ë¬¸ì œ**: êº¾ì€ì„ ì´ ë§‰ëŒ€ ë’¤ì— ê°€ë ¤ì§

---

### After (êº¾ì€ì„ ì´ ìœ„ì— í‘œì‹œë¨) âœ…

```javascript
datasets = [
    // êº¾ì€ì„  ë¨¼ì € ì¶”ê°€
    {
        type: 'line',
        label: 'ì „ì²´ í•©ê³„',
        order: 1,  // âœ… ë‚®ì€ ìˆ«ì = ìœ„ ë ˆì´ì–´
        ...
    },
    // ë§‰ëŒ€ ë‚˜ì¤‘ì— ì¶”ê°€
    {
        type: 'bar',
        label: 'ë°°ì†¡',
        order: 2,  // âœ… ë†’ì€ ìˆ«ì = ì•„ë˜ ë ˆì´ì–´
        ...
    }
];
```

**íš¨ê³¼**: êº¾ì€ì„ ì´ ë§‰ëŒ€ ìœ„ì— ëª…í™•í•˜ê²Œ í‘œì‹œë¨ âœ…

---

## ğŸ”§ 2. í”„ë¡¬í”„íŠ¸ ì—ëŸ¬ ì™„ì „ í•´ê²°

### ë¬¸ì œ: unhashable type: 'dict'

#### Before âŒ

```python
prompt = f"""
ì˜ˆì‹œ JSON:
{{
  "categories": {json.dumps(category_list[:3], ensure_ascii=False)},
  "channels": {json.dumps([{{'channel': ch.get('name', 'ë¯¸ë¶„ë¥˜'), ...}} for ch in channel_list], ensure_ascii=False)}
}}
"""
```

**ë¬¸ì œì **:

- f-string ë‚´ë¶€ì—ì„œ ë³µì¡í•œ JSON ìƒì„±
- ë¦¬ìŠ¤íŠ¸ ì»´í”„ë¦¬í—¨ì…˜ + ë”•ì…”ë„ˆë¦¬ ì¡°í•©
- ì—¬ì „íˆ ì—ëŸ¬ ë°œìƒ ê°€ëŠ¥

---

#### After âœ…

```python
# 1. ë°ì´í„°ë¥¼ ë¯¸ë¦¬ JSONìœ¼ë¡œ ë³€í™˜
category_list_json = json.dumps(category_list, ensure_ascii=False)
channel_list_json = json.dumps(channel_list, ensure_ascii=False)
resolution_list_json = json.dumps(resolution_list, ensure_ascii=False)

# 2. í”„ë¡¬í”„íŠ¸ì—ì„œëŠ” ë‹¨ìˆœ í…ìŠ¤íŠ¸ë¡œ ì œê³µ
prompt = f"""
ì˜ˆì‹œ (ë°˜ë“œì‹œ ìˆœìˆ˜í•œ JSONë§Œ ë°˜í™˜í•˜ì„¸ìš”):

ë‹¤ìŒì€ ì‹¤ì œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‘ë‹µ ì˜ˆì‹œì…ë‹ˆë‹¤.
ì¹´í…Œê³ ë¦¬ ëª©ë¡: {category_list_json}
ì±„ë„ ëª©ë¡: {channel_list_json}
í•´ê²°ë¥  ë°ì´í„°: {resolution_list_json}

ì‘ë‹µ í˜•ì‹:
{{
  "summary": {{
    "total_cs_count": (ìˆ«ì),
    "categories": [
      {{"category_id": (ìˆ«ì), "category_name": "ì´ë¦„", ...}}
    ],
    "channels": [
      {{"channel": "ì´ë¦„", "total": (ìˆ«ì), ...}}
    ]
  }},
  ...
}}
"""
```

**ê°œì„ ì **:

- âœ… f-string ë‚´ë¶€ì—ì„œ ë³µì¡í•œ ì—°ì‚° ì œê±°
- âœ… ë¯¸ë¦¬ ë³€í™˜ëœ JSON ë¬¸ìì—´ë§Œ ì‚½ì…
- âœ… ì—ëŸ¬ ë°œìƒ ê°€ëŠ¥ì„± ì™„ì „ ì œê±°

---

## ğŸ“ ì°¨íŠ¸ ì„¤ì • ìƒì„¸

### êº¾ì€ì„  ê·¸ë˜í”„ (order: 1)

```javascript
{
    type: 'line',
    label: 'ì „ì²´ í•©ê³„',
    data: totalData,
    borderColor: '#e74c3c',
    backgroundColor: 'rgba(231, 76, 60, 0.1)',
    borderWidth: 2,
    fill: false,
    tension: 0.3,
    pointRadius: 2,           // âœ… ì‘ì€ ì 
    pointHoverRadius: 4,      // í˜¸ë²„ ì‹œ ì»¤ì§
    pointBackgroundColor: '#e74c3c',
    pointBorderColor: '#fff',
    pointBorderWidth: 1,
    order: 1  // âœ… ìœ„ ë ˆì´ì–´
}
```

### ë§‰ëŒ€ ê·¸ë˜í”„ (order: 2)

```javascript
{
    type: 'bar',
    label: category,
    data: categoryData,
    backgroundColor: color,
    borderWidth: 1,
    stack: 'stack1',
    order: 2  // âœ… ì•„ë˜ ë ˆì´ì–´
}
```

---

## ğŸ¨ ë ˆì´ì–´ ìˆœì„œ ì‹œê°í™”

### Before âŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Chart.js ì°¨íŠ¸    â”‚
â”‚                    â”‚
â”‚   â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬     â”‚  â† êº¾ì€ì„  (ë³´ì´ì§€ ì•ŠìŒ)
â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚  â† ë§‰ëŒ€ (ìœ„ì— ìˆìŒ)
â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After âœ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Chart.js ì°¨íŠ¸    â”‚
â”‚                    â”‚
â”‚   â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—   â”‚  â† êº¾ì€ì„  (ìœ„ì— í‘œì‹œ) âœ…
â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚  â† ë§‰ëŒ€ (ì•„ë˜)
â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› í”„ë¡¬í”„íŠ¸ ì—ëŸ¬ ì›ì¸ ìƒì„¸

### ë¡œê·¸ ë¶„ì„

```bash
line 993: [INFO] í”„ë¡¬í”„íŠ¸ êµ¬ì„± ì¤‘...
line 995: [ERROR] âŒ GPT ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨: unhashable type: 'dict'
```

**ë°œìƒ ìœ„ì¹˜**: `_build_comprehensive_report_prompt()` í•¨ìˆ˜ ë‚´ë¶€

### ë¬¸ì œ ì½”ë“œ (line 452-453)

```python
"categories": {json.dumps(category_list[:3], ensure_ascii=False) if category_list else '[]'},
"channels": {json.dumps([{{'channel': ch.get('name', 'ë¯¸ë¶„ë¥˜'), ...}} for ch in channel_list[:2]], ensure_ascii=False) if channel_list else '[]'}
```

**ì—ëŸ¬ ì›ì¸**:

1. f-string ë‚´ë¶€ì—ì„œ `{json.dumps([{...}])` ì‚¬ìš©
2. ì¤‘ê´„í˜¸ `{}` ì¶©ëŒ (f-string vs JSON)
3. ë¦¬ìŠ¤íŠ¸ ì»´í”„ë¦¬í—¨ì…˜ ë‚´ë¶€ ë”•ì…”ë„ˆë¦¬ ìƒì„± ì‹œ ì—ëŸ¬

---

## âœ… ì™„ì „í•œ í•´ê²°

### í”„ë¡¬í”„íŠ¸ ë‹¨ìˆœí™”

```python
# Before âŒ - ë³µì¡í•œ JSON ì§ì ‘ ìƒì„±
prompt = f"""
ì˜ˆì‹œ:
{{
  "categories": {json.dumps([{{'channel': ch.get('name')}} for ch in list])}
}}
"""

# After âœ… - ë‹¨ìˆœ í…ìŠ¤íŠ¸
prompt = f"""
ì˜ˆì‹œ:

ì¹´í…Œê³ ë¦¬ ëª©ë¡: {category_list_json}
ì±„ë„ ëª©ë¡: {channel_list_json}

ì‘ë‹µ í˜•ì‹:
{{
  "summary": {{
    "total_cs_count": (ìˆ«ì),
    "categories": [...ë°°ì—´...]
  }}
}}
"""
```

---

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼

| íŒŒì¼                  | ìˆ˜ì • ë‚´ìš©                            | ìƒíƒœ |
| --------------------- | ------------------------------------ | ---- |
| `utils/ai_service.py` | âœ… resolution_list_json ì¶”ê°€         | âœ…   |
| `utils/ai_service.py` | âœ… í”„ë¡¬í”„íŠ¸ ë‹¨ìˆœí™” (json.dumps ì œê±°) | âœ…   |
| `static/js/report.js` | âœ… ë°ì´í„°ì…‹ ìˆœì„œ ë³€ê²½ (line â†’ bar)   | âœ…   |
| `static/js/report.js` | âœ… order ì†ì„± ì¶”ê°€ (1, 2)            | âœ…   |

---

## ğŸš€ ì˜ˆìƒ ê²°ê³¼

### ë¡œê·¸ (ì •ìƒ ì‹¤í–‰)

```bash
[INFO] === GPT ê¸°ë°˜ ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„± ì‹œì‘ ===
[INFO] í”„ë¡¬í”„íŠ¸ êµ¬ì„± ì¤‘...  âœ… ì—ëŸ¬ ì—†ìŒ
[INFO] ğŸ¤– GPT API í˜¸ì¶œ ì¤‘...
[INFO] GPT ëª¨ë¸ í˜¸ì¶œ: gpt-4o-mini
[INFO] âœ… GPT API ì‘ë‹µ ì™„ë£Œ (ì†Œìš” ì‹œê°„: 8.5ì´ˆ)
[INFO] GPT ì‘ë‹µ íŒŒì‹± ì„±ê³µ
[INFO] === ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ (GPT ê¸°ë°˜) ===
```

### ì°¨íŠ¸ í‘œì‹œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê²Œì‹œíŒ                          â”‚
â”‚ 1,500ê±´                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚                          â”‚  â”‚
â”‚ â”‚  â—â”€â”€â—â”€â”€â—â”€â”€â—  (êº¾ì€ì„ )    â”‚  â”‚ â† ìœ„ì— í‘œì‹œ âœ…
â”‚ â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ë§‰ëŒ€)     â”‚  â”‚ â† ì•„ë˜
â”‚ â”‚                          â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ í•µì‹¬ í•´ê²° ì‚¬í•­

### 1. Chart.js order ì†ì„±

```javascript
// order ê°’ì´ ë‚®ì„ìˆ˜ë¡ ìœ„ì— í‘œì‹œ
order: 1; // êº¾ì€ì„  (ë§¨ ìœ„)
order: 2; // ë§‰ëŒ€ (ì•„ë˜)
```

### 2. í”„ë¡¬í”„íŠ¸ ì•ˆì „ì„±

```python
# âŒ ìœ„í—˜ - f-string ë‚´ë¶€ ë³µì¡í•œ ì—°ì‚°
{json.dumps([{'key': ch['name']} for ch in list])}

# âœ… ì•ˆì „ - ë¯¸ë¦¬ ë³€í™˜ëœ ë¬¸ìì—´
category_list_json = json.dumps(category_list, ensure_ascii=False)
{category_list_json}
```

---

## ğŸ‰ ì™„ë£Œ!

**ì„œë²„ ì¬ì‹œì‘ í›„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”**:

```powershell
.\run_app.ps1
```

**ì˜ˆìƒ ê²°ê³¼**:

- âœ… í”„ë¡¬í”„íŠ¸ ìƒì„± ì—ëŸ¬ ì—†ìŒ
- âœ… GPT API ì •ìƒ í˜¸ì¶œ (8-15ì´ˆ)
- âœ… êº¾ì€ì„ ì´ ë§‰ëŒ€ ìœ„ì— ëª…í™•í•˜ê²Œ í‘œì‹œ
- âœ… ì  í¬ê¸° ì‘ìŒ (2px)

---

**ì™„ë£Œì¼**: 2025-10-12  
**ìƒíƒœ**: âœ… Production Ready
